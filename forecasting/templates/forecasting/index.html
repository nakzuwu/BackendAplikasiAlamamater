<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Peramalan Jas Almamater</title>

    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />

    <style>
      :root {
        --bg-primary: #0d1117;
        --bg-secondary: #161b22;
        --bg-card: #21262d;
        --text-primary: #f0f6fc;
        --text-secondary: #8b949e;
        --accent-primary: #58a6ff;
        --accent-secondary: #1f6feb;
        --accent-success: #3fb950;
        --border-color: #30363d;
        --input-bg: #0d1117;
      }

      body {
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        transition: all 0.3s ease;
      }

      .container {
        max-width: 700px;
        margin-top: 50px;
      }

      .card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
      }

      .form-control {
        background-color: var(--input-bg);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        border-radius: 8px;
        padding: 12px 15px;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        background-color: var(--input-bg);
        border-color: var(--accent-primary);
        color: var(--text-primary);
        box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
      }

      .form-control::placeholder {
        color: var(--text-secondary);
        opacity: 0.7;
      }

      .form-label {
        color: var(--text-primary);
        font-weight: 500;
        margin-bottom: 8px;
      }

      .form-text {
        color: var(--text-secondary) !important;
        font-size: 0.85rem;
      }

      .btn {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(31, 111, 235, 0.3);
      }

      .btn-success {
        background: linear-gradient(135deg, #2ea043, #3fb950);
        color: white;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(63, 185, 80, 0.3);
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: var(--text-primary);
        font-weight: 600;
      }

      .text-primary {
        color: var(--accent-primary) !important;
      }

      .text-secondary {
        color: var(--text-secondary) !important;
      }

      .text-muted {
        color: var(--text-secondary) !important;
      }

      .header-icon {
        font-size: 1.8rem;
        margin-right: 10px;
        vertical-align: middle;
      }

      .input-icon {
        position: relative;
      }

      .input-icon .form-control {
        padding-left: 45px;
      }

      .input-icon i {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-secondary);
        z-index: 2;
      }

      .feature-card {
        background: var(--bg-secondary);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        border-left: 4px solid var(--accent-primary);
        margin-bottom: 20px;
      }

      .feature-icon {
        font-size: 2rem;
        color: var(--accent-primary);
        margin-bottom: 10px;
      }
      /* 
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
      } */

      .theme-toggle:hover {
        transform: rotate(15deg);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      footer {
        margin-top: 50px;
        padding: 20px 0;
        border-top: 1px solid var(--border-color);
      }

      .file-upload-area {
        border: 2px dashed var(--border-color);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        transition: all 0.3s ease;
        background: var(--bg-secondary);
        cursor: pointer;
      }

      .file-upload-area:hover {
        border-color: var(--accent-primary);
        background: rgba(88, 166, 255, 0.05);
      }

      .file-upload-area.dragover {
        border-color: var(--accent-success);
        background: rgba(63, 185, 80, 0.1);
      }

      .upload-icon {
        font-size: 3rem;
        color: var(--accent-primary);
        margin-bottom: 15px;
      }

      @media (max-width: 768px) {
        .container {
          margin-top: 80px;
          padding: 0 15px;
        }

        .theme-toggle {
          top: 15px;
          right: 15px;
        }
      }
    </style>
  </head>

  <body>
    <div class="theme-toggle" id="themeToggle"></div>

    <div class="container">
      <div class="text-center mb-5">
        <h1 class="fw-bold text-primary mb-3">
          <i class="bi bi-graph-up header-icon"></i>Prediksi Jas Almamater
        </h1>
        <p class="text-muted fs-5">
          Gunakan data historis untuk memprediksi kebutuhan tahun berikutnya
        </p>
      </div>

      <!-- Features Section -->
      <div class="row mb-5">
        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="bi bi-calculator"></i>
            </div>
            <h5>Metode Exponential Smoothing</h5>
            <p class="text-muted small">
              Menggunakan algoritma peramalan yang akurat
            </p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="bi bi-file-earmark-spreadsheet"></i>
            </div>
            <h5>Format CSV</h5>
            <p class="text-muted small">
              Mendukung upload data dalam format CSV
            </p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="feature-card">
            <div class="feature-icon">
              <i class="bi bi-bar-chart"></i>
            </div>
            <h5>Visualisasi Data</h5>
            <p class="text-muted small">
              Hasil prediksi ditampilkan dalam grafik interaktif
            </p>
          </div>
        </div>
      </div>

      <div class="card p-4 mb-4">
    <h4 class="text-secondary mb-4">
        <i class="bi bi-sliders header-icon"></i>Pilih Presisi Alpha
    </h4>
    
    <div class="alert alert-info mb-3">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Pilih jenis perhitungan alpha:</strong> Semakin kecil step, semakin akurat namun membutuhkan waktu lebih lama.
    </div>
    
    <div class="row">
        <div class="col-md-6 mb-3">
            <div class="alpha-option card p-3 text-center" 
                 onclick="selectAlphaOption('0.1', this)">
                <div class="feature-icon">
                    <i class="bi bi-lightning-charge"></i>
                </div>
                <h5>Alpha Step 0.1</h5>
                <div class="metric-value text-primary fw-bold">9 Kombinasi</div>
                <p class="text-muted small mb-0">
                    (0.1, 0.2, 0.3, ..., 0.9)
                </p>
                <div class="mt-2">
                    <span class="badge bg-success">Cepat</span>
                    <span class="badge bg-secondary">Default</span>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="alpha-option card p-3 text-center"
                 onclick="selectAlphaOption('0.01', this)">
                <div class="feature-icon">
                    <i class="bi bi-zoom-in"></i>
                </div>
                <h5>Alpha Step 0.01</h5>
                <div class="metric-value text-warning fw-bold">99 Kombinasi</div>
                <p class="text-muted small mb-0">
                    (0.01, 0.02, 0.03, ..., 0.99)
                </p>
                <div class="mt-2">
                    <span class="badge bg-warning">Detail</span>
                    <span class="badge bg-info">Akurat</span>
                </div>
            </div>
        </div>
    </div>
    
    <input type="hidden" name="alpha_step" id="alphaStepInput" value="0.1">
    
    <div class="text-center mt-3">
        <div id="alphaSelectionInfo" class="alert alert-success">
            <i class="bi bi-check-circle me-2"></i>
            <span id="alphaInfoText">Alpha step 0.1 dipilih (9 kombinasi) - Perhitungan lebih cepat</span>
        </div>
    </div>
</div>

      <!-- Ganti bagian input manual dengan ini -->
<div class="card p-4 mb-4">
    <h4 class="text-secondary mb-4">
        <i class="bi bi-keyboard header-icon"></i>Input Manual
    </h4>
    <form method="POST" enctype="multipart/form-data" action="{% url 'forecast' %}" id="manualForm">
        {% csrf_token %}
         <input type="hidden" name="alpha_step" id="manualAlphaStep" value="0.1">
              <div class="mb-4">
                  <label for="data" class="form-label">
                      Masukkan Data Permintaan (Format: Baris pertama header ukuran, baris berikutnya data per tahun)
                  </label>
                  <div class="input-icon">
                      <i class="bi bi-list-ol"></i>
                      <textarea
                          class="form-control"
                          name="data"
                          id="dataInput"
                          rows="6"
                          placeholder="Contoh:
      S,M,L,XL,XXL
      2019,85,120,150,90,55
      2020,90,125,155,95,60
      2021,95,130,160,100,65

      Baris pertama: nama ukuran dipisahkan koma
      Baris berikutnya: tahun, kemudian nilai untuk setiap ukuran"
                      ></textarea>
                  </div>
                  <div class="form-text mt-2">
                      <i class="bi bi-info-circle me-1"></i>
                      Format: Baris 1 = header ukuran, Baris 2+ = tahun,value1,value2,...
                  </div>
                  
                  <!-- Preview table -->
                  <div id="previewTable" class="mt-3" style="display: none;">
                      <h6 class="text-primary">Preview Data:</h6>
                      <div class="table-responsive">
                          <table class="table table-sm table-bordered" id="dataPreview">
                              <thead>
                                  <tr id="previewHeader"></tr>
                              </thead>
                              <tbody id="previewBody"></tbody>
                          </table>
                      </div>
                  </div>
              </div>
        <button type="submit" class="btn btn-primary w-100 py-3">
            <i class="bi bi-calculator me-2"></i>Proses Peramalan dengan Alpha Step 0.1
        </button>
          </form>
      </div>

      <script>
      // Preview input data
      document.getElementById('dataInput').addEventListener('input', function(e) {
          const input = e.target.value.trim();
          const previewTable = document.getElementById('previewTable');
          const previewHeader = document.getElementById('previewHeader');
          const previewBody = document.getElementById('previewBody');
          
          if (!input) {
              previewTable.style.display = 'none';
              return;
          }
          
          const lines = input.split('\n').filter(line => line.trim());
          
          if (lines.length < 2) {
              previewTable.style.display = 'none';
              return;
          }
          
          // Parse headers (baris pertama)
          const headers = lines[0].split(',').map(h => h.trim());
          let headerHTML = '<th>Tahun</th>';
          headers.forEach(header => {
              headerHTML += `<th>${header}</th>`;
          });
          previewHeader.innerHTML = headerHTML;
          
          // Parse data rows
          let bodyHTML = '';
          for (let i = 1; i < lines.length; i++) {
              const cells = lines[i].split(',').map(c => c.trim());
              if (cells.length === headers.length + 1) { // +1 untuk tahun
                  bodyHTML += '<tr>';
                  cells.forEach((cell, index) => {
                      bodyHTML += `<td>${cell}</td>`;
                  });
                  bodyHTML += '</tr>';
              }
          }
          
          previewBody.innerHTML = bodyHTML;
          previewTable.style.display = 'block';
      });
      </script>
<div class="card p-4">
    <h4 class="text-secondary mb-4">
        <i class="bi bi-cloud-upload header-icon"></i>Upload File CSV
    </h4>
    <form action="/forecast/" method="POST" enctype="multipart/form-data" id="csvForm">
        {% csrf_token %}
        <input type="hidden" name="alpha_step" id="csvAlphaStep" value="0.1">
          <div class="mb-4">
            <label for="file" class="form-label">Pilih File CSV</label>

            <div class="file-upload-area" id="fileUploadArea">
              <div class="upload-icon">
                <i class="bi bi-cloud-arrow-up"></i>
              </div>
              <h5 class="text-primary">
                Seret file ke sini atau klik untuk memilih
              </h5>
              <p class="text-muted small mt-2">Format yang didukung: .csv</p>
              <input
                type="file"
                class="d-none"
                name="file"
                accept=".csv"
                id="fileInput"
              />
            </div>

            <div class="form-text mt-3">
              <i class="bi bi-file-earmark-spreadsheet me-1"></i>
              Pastikan file CSV memiliki kolom Tahun dan ukuran (S, M, L, XL,
              XXL)
            </div>
          </div>
        <button type="submit" class="btn btn-success w-100 py-3">
            <i class="bi bi-upload me-2"></i>Upload & Proses dengan Alpha Step 0.1
        </button>
        </form>
      </div>

      <footer class="text-center mt-5">
        <small class="text-muted">
          Â© 2025 Aplikasi Prediksi Jas Almamater | Built with Django & Bootstrap
        </small>
      </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Theme toggle functionality
      document
        .getElementById("themeToggle")
        .addEventListener("click", function () {
          const body = document.body;
          const themeIcon = document.getElementById("themeIcon");

          if (body.classList.contains("light-mode")) {
            // Switch to dark mode
            body.classList.remove("light-mode");
            themeIcon.classList.remove("bi-sun-fill");
            themeIcon.classList.add("bi-moon-fill");
          } else {
            // Switch to light mode
            body.classList.add("light-mode");
            themeIcon.classList.remove("bi-moon-fill");
            themeIcon.classList.add("bi-sun-fill");
          }
        });
      // File upload area functionality
      const fileUploadArea = document.getElementById("fileUploadArea");
      const fileInput = document.getElementById("fileInput");

      // Biar area bisa diklik
      fileUploadArea.addEventListener("click", () => {
        fileInput.click();
      });

      // Drag & drop events
      fileUploadArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        fileUploadArea.classList.add("dragover");
      });

      fileUploadArea.addEventListener("dragleave", () => {
        fileUploadArea.classList.remove("dragover");
      });

      fileUploadArea.addEventListener("drop", (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove("dragover");

        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          const fileName = e.dataTransfer.files[0].name;
          updateUploadAreaUI(fileName);
        }
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length) {
          const fileName = e.target.files[0].name;
          updateUploadAreaUI(fileName);
        }
      });

      // ðŸ”§ Update tampilan upload area tanpa hapus input
      function updateUploadAreaUI(fileName) {
        const iconEl = fileUploadArea.querySelector(".upload-icon");
        const titleEl = fileUploadArea.querySelector("h5");
        const descEl = fileUploadArea.querySelector("p.text-muted");

        if (iconEl && titleEl && descEl) {
          iconEl.innerHTML = `<i class="bi bi-check-circle text-success"></i>`;
          titleEl.textContent = "File Siap Diupload";
          descEl.textContent = fileName;
        }
      }

      // Form validation
      document.getElementById("csvForm").addEventListener("submit", (e) => {
        if (!fileInput.files.length) {
          e.preventDefault();
          alert("Silakan pilih file CSV terlebih dahulu");
          fileUploadArea.style.borderColor = "#f85149";
          setTimeout(() => {
            fileUploadArea.style.borderColor = "";
          }, 2000);
        }
      });
      // Variabel untuk menyimpan alpha step yang dipilih
let selectedAlphaStep = '0.1';

// Fungsi untuk memilih alpha option
function selectAlphaOption(step, element) {
    selectedAlphaStep = step;
    
    // Update UI semua alpha option
    document.querySelectorAll('.alpha-option').forEach(option => {
        option.style.borderColor = '#30363d';
        option.style.backgroundColor = '';
    });
    
    // Sorot yang dipilih
    element.style.borderColor = '#3fb950';
    element.style.backgroundColor = 'rgba(63, 185, 80, 0.1)';
    
    // Update info teks
    const infoText = document.getElementById('alphaInfoText');
    if (step === '0.1') {
        infoText.textContent = 'Alpha step 0.1 dipilih (9 kombinasi) - Perhitungan lebih cepat';
        infoText.parentElement.className = 'alert alert-success';
    } else {
        infoText.textContent = 'Alpha step 0.01 dipilih (99 kombinasi) - Hasil lebih akurat';
        infoText.parentElement.className = 'alert alert-warning';
    }
    
    // Update semua hidden inputs
    document.getElementById('alphaStepInput').value = step;
    document.getElementById('manualAlphaStep').value = step;
    document.getElementById('csvAlphaStep').value = step;
    
    // Update tombol submit
    const manualBtn = document.querySelector('#manualForm button[type="submit"]');
    const csvBtn = document.querySelector('#csvForm button[type="submit"]');
    
    if (step === '0.1') {
        manualBtn.innerHTML = '<i class="bi bi-calculator me-2"></i>Proses Peramalan dengan Alpha Step 0.1';
        csvBtn.innerHTML = '<i class="bi bi-upload me-2"></i>Upload & Proses dengan Alpha Step 0.1';
    } else {
        manualBtn.innerHTML = '<i class="bi bi-calculator me-2"></i>Proses Peramalan dengan Alpha Step 0.01';
        csvBtn.innerHTML = '<i class="bi bi-upload me-2"></i>Upload & Proses dengan Alpha Step 0.01';
    }
}

// Tambahkan event listener untuk form
document.getElementById('manualForm').addEventListener('submit', function(e) {
    // Tambahkan konfirmasi jika memilih 0.01 (karena lebih berat)
    if (selectedAlphaStep === '0.01') {
        const confirmed = confirm(
            'Anda memilih Alpha Step 0.01 (99 kombinasi).\n' +
            'Perhitungan akan memakan waktu lebih lama.\n' +
            'Apakah Anda yakin ingin melanjutkan?'
        );
        
        if (!confirmed) {
            e.preventDefault();
            return false;
        }
        
        // Tampilkan loading indicator
        const btn = this.querySelector('button[type="submit"]');
        btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Memproses...';
        btn.disabled = true;
    }
});

document.getElementById('csvForm').addEventListener('submit', function(e) {
    // Validasi file dulu
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
        e.preventDefault();
        alert("Silakan pilih file CSV terlebih dahulu");
        return false;
    }
    
    // Konfirmasi untuk alpha step 0.01
    if (selectedAlphaStep === '0.01') {
        const confirmed = confirm(
            'Anda memilih Alpha Step 0.01 (99 kombinasi).\n' +
            'Perhitungan akan memakan waktu lebih lama.\n' +
            'Apakah Anda yakin ingin melanjutkan?'
        );
        
        if (!confirmed) {
            e.preventDefault();
            return false;
        }
        
        // Tampilkan loading indicator
        const btn = this.querySelector('button[type="submit"]');
        btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Memproses...';
        btn.disabled = true;
    }
});

// Inisialisasi saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
    // Set default alpha option
    const defaultOption = document.querySelector('.alpha-option:first-child');
    if (defaultOption) {
        selectAlphaOption('0.1', defaultOption);
    }
    
    // Tambahkan style untuk alpha option
    const style = document.createElement('style');
    style.textContent = `
        .alpha-option {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #30363d;
            height: 100%;
        }
        
        .alpha-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(88, 166, 255, 0.2);
            border-color: #58a6ff;
        }
        
        .alpha-option .metric-value {
            font-size: 1.5rem;
            margin: 10px 0;
        }
        
        .alpha-option .feature-icon {
            font-size: 2.5rem;
        }
        
        #alphaSelectionInfo {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    `;
    document.head.appendChild(style);
});
    </script>
  </body>
</html>
